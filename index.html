<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lettuce Disease Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #c28e4f;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-amber-50 flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-lg w-full text-center">
        <h1 class="text-3xl font-bold text-stone-800 mb-2">Lettuce Disease Detector</h1>
        <p class="text-stone-600 mb-6">Upload an image of a lettuce leaf to classify its health.</p>

        <form id="upload-form">
            <div class="border-2 border-dashed border-stone-300 rounded-lg p-8 mb-6 cursor-pointer hover:bg-stone-50" id="upload-area">
                <input type="file" id="image-upload" class="hidden" accept="image/*">
                <label for="image-upload" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-stone-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                    <p class="mt-2 text-sm text-stone-500"><span class="font-semibold text-amber-700">Click to upload</span> or drag and drop</p>
                </label>
            </div>
        </form>

        <div id="image-preview-container" class="mb-6 hidden">
            <img id="image-preview" src="#" alt="Image preview" class="max-w-full mx-auto rounded-lg shadow-md" style="max-height: 300px;"/>
        </div>

        <button id="predict-button" class="bg-amber-600 text-white font-bold py-3 px-6 rounded-lg w-full hover:bg-amber-700 transition duration-300 ease-in-out disabled:bg-stone-400 disabled:cursor-not-allowed flex items-center justify-center" disabled>
            <span id="button-text">Analyze Lettuce Leaf</span>
            <div id="button-loader" class="loader hidden ml-3"></div>
        </button>

        <div id="result-container" class="mt-8 text-left bg-amber-50 p-6 rounded-lg hidden">
            <h2 class="text-xl font-semibold text-stone-800 mb-4">Analysis Result</h2>
            <div class="space-y-2">
                <p><strong>Status:</strong> <span id="prediction-status" class="font-semibold"></span></p>
                <p><strong>Details:</strong> <span id="prediction-details" class="text-stone-700"></span></p>
            </div>
        </div>
    </div>

    <script>
        const uploadForm = document.getElementById('upload-form');
        const imageUpload = document.getElementById('image-upload');
        const uploadArea = document.getElementById('upload-area');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const predictButton = document.getElementById('predict-button');
        const resultContainer = document.getElementById('result-container');
        const predictionStatus = document.getElementById('prediction-status');
        const predictionDetails = document.getElementById('prediction-details');
        const buttonText = document.getElementById('button-text');
        const buttonLoader = document.getElementById('button-loader');

        let selectedFile;

        imageUpload.addEventListener('change', (event) => {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                    predictButton.disabled = false;
                    resultContainer.classList.add('hidden');
                };
                reader.readAsDataURL(selectedFile);
            }
        });
        
        uploadArea.addEventListener('dragover', (e) => e.preventDefault());
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUpload.files = e.dataTransfer.files;
            imageUpload.dispatchEvent(new Event('change'));
        });

        predictButton.addEventListener('click', async () => {
            if (!selectedFile) { alert("Please select an image first."); return; }

            buttonText.innerText = 'Analyzing...';
            buttonLoader.classList.remove('hidden');
            predictButton.disabled = true;

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData,
                });
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.statusText}`);
                }

                const data = await response.json();
                displayResults(data.prediction);

            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during prediction.');
            } finally {
                buttonText.innerText = 'Analyze Lettuce Leaf';
                buttonLoader.classList.add('hidden');
                predictButton.disabled = false;
            }
        });

        function displayResults(predictedClassName) {
            let status = "Diseased";
            let details = predictedClassName.replace(/_/g, ' ').replace(' on lettuce', '');
            let statusColor = "text-red-600";
            
            if (predictedClassName === 'Healthy') {
                status = "Healthy";
                details = "No disease detected.";
                statusColor = "text-green-600";
            } else if (predictedClassName === 'Shepherd_purse_weeds') {
                status = "Not Lettuce";
                details = "This appears to be a weed (Shepherd's purse).";
                statusColor = "text-orange-600";
            }

            predictionStatus.innerText = status;
            predictionStatus.className = `font-bold ${statusColor}`;
            predictionDetails.innerText = details;
            resultContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>

